<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template.xhtml">

    <ui:define name="title">
        Dashboard - Gestión Hospitalaria
    </ui:define>

    <ui:define name="content">

        <p:panel header="Acciones Rápidas">
            <h:form>
                <h:panelGrid columns="4" cellpadding="10">
                    <p:button value="Agendar Cita" icon="pi pi-calendar-plus" outcome="cita" rendered="#{loginBean.loginViewModel.usuarioLogueado.rol != 'ADMIN'}" />
                    <p:button value="Registrar Paciente" icon="pi pi-user-plus" outcome="pacientes" rendered="#{loginBean.loginViewModel.usuarioLogueado.rol == 'RECEPCIONISTA'}" />
                    <p:button value="Ver Historiales" icon="pi pi-book" outcome="historial" rendered="#{loginBean.loginViewModel.usuarioLogueado.rol == 'DOCTOR'}" />
                    <p:button value="Gestionar Usuarios" icon="pi pi-shield" outcome="usuarios" rendered="#{loginBean.loginViewModel.usuarioLogueado.rol == 'ADMIN'}" />
                </h:panelGrid>
            </h:form>
        </p:panel>

        <p:panel header="Resumen del Sistema" style="margin-top: 20px;">
            <h:panelGrid columns="2" cellpadding="20" style="width: 100%;">

                <p:panel header="Distribución de Citas por Estado">
                    <p:chart type="pie"
                             model="#{dashboardBean.pieModelJson}"
                             style="width: 400px; height: 300px;"/>
                </p:panel>

                <p:panel header="Conteo General del Sistema">
                    <p:chart type="bar"
                             model="#{dashboardBean.barModelJson}"
                             style="width: 500px; height: 300px;"/>
                </p:panel>
            </h:panelGrid>
        </p:panel>

        <p:panel header="Próximas 5 Citas" style="margin-top: 20px;">
            <p:dataTable value="#{dashboardBean.proximasCitas}"
                         var="cita"
                         emptyMessage="No hay citas próximas agendadas."
                         rows="5">

                <p:column headerText="Fecha y Hora"><h:outputText value="#{cita.fecha_hora_cita}" /></p:column>
                <p:column headerText="ID Paciente"><h:outputText value="#{cita.id_paciente_fk}" /></p:column>
                <p:column headerText="ID Doctor"><h:outputText value="#{cita.id_doctor_fk}" /></p:column>
                <p:column headerText="Motivo"><h:outputText value="#{cita.motivo_consulta}" /></p:column>
                <p:column headerText="Estado"><h:outputText value="#{cita.estado_cita}" /></p:column>
            </p:dataTable>
        </p:panel>

    </ui:define>
</ui:composition>